<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Links</title>
    <meta name="description" content="Links â€¢ A-Frame">
    <script src="js/aframe-master.js"></script>
    <script src="js/components/aframe-tooltip-component.js"></script>
    <script src="js/components/camera-position.js"></script>
    <script src="js/components/link-controls.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.x/dist/aframe-environment-component.min.js"></script>
    <script src="js/info-message.js"></script>
    <script src="https://gftruj.github.io/webzamples/aframe/controls/oculus-thumbstick-controls.js"></script>
</head>
<body>
<a-scene
        fog="color: #241417; near: 0; far: 30;"
        raycaster="far: 100; objects: [link];"
        cursor="rayOrigin: mouse"
        camera-position environment="preset: starry"
        info-message="htmlSrc: #messageText">
    <a-assets>
        <img id="thumbJapan" crossOrigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/japan.png">
        <img id="thumbEgypt" crossOrigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/egypt.png">
        <img id="thumbForest" crossOrigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/forest.png">
        <img id="thumbDessert" crossOrigin="anonymous" src="./images/dessert.png">
        <img id="thumbStarry" crossOrigin="anonymous" src="./images/starry.png">
        <img id="thumbArches" crossOrigin="anonymous" src="./images/arches.png">
        <img id="thumbDreamland" crossOrigin="anonymous" src="./images/dreamland.png">
        <img id="thumbMushroomForest" crossOrigin="anonymous" src="./images/mushroomforest.png">
        <img id="thumbMysteryLand" crossOrigin="anonymous" src="./images/mysteryland.png">
        <a-asset-item id="messageText" src="message.html"></a-asset-item>
    </a-assets>

    <a-entity id="rig" movement-controls>
        <!-- Camera met positionering binnen de rig -->
        <a-camera position="0 1.6 0"></a-camera>

        <!-- Linker Oculus-controller: gebruik voor verplaatsing -->
        <a-entity
                oculus-touch-controls="hand: left"
                oculus-thumbstick-controls
                link-controls="hand: left">
        </a-entity>

        <!-- Rechter Oculus-controller: alleen gebruikt voor rondkijken -->
        <a-entity
                id="right-controller"
                oculus-touch-controls="hand: right">
        </a-entity>
    </a-entity>

    <!-- Links om te teleporteren naar andere werelden -->
    <a-link href="japan.html" position="-16 1.5 0" rotation="0 0 0" image="#thumbJapan"></a-link>
    <a-link href="egypt.html" position="-12 1.5 0" rotation="0 0 0" image="#thumbEgypt"></a-link>
    <a-link href="forest.html" position="-8 1.5 0" rotation="0 0 0" image="#thumbForest"></a-link>
    <a-link href="dessert.html" position="-4 1.5 0" rotation="0 0 0" image="#thumbDessert"></a-link>
    <a-link href="starry.html" position="0 1.5 0" rotation="0 0 0" image="#thumbStarry"></a-link>
    <a-link href="arches.html" position="4 1.5 0" rotation="0 0 0" image="#thumbArches"></a-link>
    <a-link href="dreamland.html" position="8 1.5 0" rotation="0 0 0" image="#thumbDreamland"></a-link>
    <a-link href="mushroom_forest.html" position="12 1.5 0" rotation="0 0 0" image="#thumbMushroomForest"></a-link>
    <a-link href="mystery_land.html" position="16 1.5 0" rotation="0 0 0" image="#thumbMysteryLand"></a-link>

</a-scene>

<script>
    // Selecteer de rechter controller en de rig
    const rightController = document.getElementById('right-controller');
    const rig = document.getElementById('rig');

    // Luister naar thumbstick bewegingen op de rechter controller voor rondkijken
    rightController.addEventListener('thumbstickmoved', function (event) {
        // Haal de huidige rotatie van de rig op
        const rotation = rig.getAttribute('rotation');

        // Pas de y-rotatie aan op basis van de x-beweging van de thumbstick (links/rechts draaien)
        rotation.y -= event.detail.x * 2;  // Gevoeligheid aanpassen indien nodig

        // Stel de nieuwe rotatie in op de rig
        rig.setAttribute('rotation', rotation);
    });

    // Luister naar bewegingen van de linker thumbstick en beweeg in de kijkrichting
    document.querySelector('[movement-controls]').addEventListener('thumbstickmoved', function (event) {
        const moveForward = event.detail.y; // Y-axis van de thumbstick voor vooruit/achteruit bewegen
        const moveRight = event.detail.x;   // X-axis voor zijwaarts bewegen

        // Huidige rotatie van de rig, nodig om de kijkrichting te bepalen
        const rigRotation = rig.getAttribute('rotation').y;

        // Bereken de richting waarin de speler kijkt (in radialen)
        const angleRad = THREE.Math.degToRad(rigRotation);

        // Bewegingsvectoren (vooruit en zijwaarts) berekenen
        const forwardVector = {x: -Math.sin(angleRad) * moveForward, z: -Math.cos(angleRad) * moveForward};
        const strafeVector = {x: Math.cos(angleRad) * moveRight, z: -Math.sin(angleRad) * moveRight};

        // Combineer de voorwaartse en zijwaartse bewegingen
        const movement = {
            x: forwardVector.x + strafeVector.x,
            z: forwardVector.z + strafeVector.z
        };

        // Pas de nieuwe positie van de rig aan
        const currentPosition = rig.getAttribute('position');
        rig.setAttribute('position', {
            x: currentPosition.x + movement.x,
            y: currentPosition.y,
            z: currentPosition.z + movement.z
        });
    });
</script>

</body>
</html>
